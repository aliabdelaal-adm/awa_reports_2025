<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„Ø´Ù‡Ø±ÙŠØ© ÙˆØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø­Ù„Ø§Øª</title>
  <style>
    html, body { direction: rtl; }
    body {font-family: 'Segoe UI', Arial, sans-serif; background: #f4f6fb;}
    h2 {text-align:center; background:#2336a0; color:#fff; padding:12px; border-radius:8px;}
    .section {background:#e2e6f6; border-radius:6px; padding:10px; margin-bottom:18px;}
    .list-item {display:inline-block; background:#2336a0; color:#fff; margin:2px; padding:4px 12px; border-radius:4px;}
    .del-btn {background:#c00; color:#fff; border:none; border-radius:50%; width:20px; height:20px; margin-left:7px; cursor:pointer;}
    .del-btn:hover {background:#a00;}
    .add-box {display:inline-block; margin-left:12px;}
    table {width:100%; border-collapse:collapse; margin-top:10px; direction: rtl;}
    th,td {border:1px solid #bbb; padding:6px; text-align:center;}
    th {background:#2336a0; color:#fff;}
    .copyright {text-align:center; color:#2336a0; font-weight:bold; margin-top:30px;}
    .footer {background:#f8f9fa; color:#555; padding:8px 20px; text-align:center; font-size:0.85em; border-top:1px solid #e0e0e0; margin-top:30px;}
    .save-btn {background:#2336a0; color:#fff; border:none; padding:8px 24px; border-radius:4px; font-size:1em; cursor:pointer;}
    .save-btn:hover {background:#2a43c7;}
    .upload-btn {background:#0fa25c; color:#fff; border:none; padding:8px 24px; border-radius:4px; font-size:1em; cursor:pointer; margin-right:8px;}
    .upload-btn:hover {background:#0b7a43;}
    .label {font-weight: bold; margin-bottom: 6px; display: inline-block;}
    .shop-section strong {display:inline-block; margin-bottom:4px;}
    input, select, button {font-family:inherit;}
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <div style="background:#1a3a5e; padding:15px; text-align:center; margin-bottom:20px; border-radius:8px;" id="navBar">
    <a href="home.html" style="color:#fff; text-decoration:none; margin:0 15px; padding:8px 16px; background:#2336a0; border-radius:5px; display:inline-block;">ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a href="developer-panel.html" style="color:#fff; text-decoration:none; margin:0 15px; padding:8px 16px; background:#c0392b; border-radius:5px; display:inline-block;">ğŸ›ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø·ÙˆØ±</a>
    <a href="awareness-campaign-report.html" style="color:#fff; text-decoration:none; margin:0 15px; padding:8px 16px; background:#2336a0; border-radius:5px; display:inline-block;" id="link-awareness">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙˆØ¹ÙŠØ©</a>
    <a href="smart-planner.html" style="color:#fff; text-decoration:none; margin:0 15px; padding:8px 16px; background:#27ae60; border-radius:5px; display:inline-block;">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
  </div>
  <h2>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„Ø´Ù‡Ø±ÙŠØ© ÙˆØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø­Ù„Ø§Øª (Ù†Ø³Ø®Ø© Ù‚Ø¯ÙŠÙ…Ø© - Ù„Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø·ÙˆØ±" Ø£Ø¹Ù„Ø§Ù‡)</h2>
  <div class="section">
    <span class="label">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØªØ´ÙŠÙ†:</span>
    <div id="inspectors"></div>
    <div class="add-box">
      <input id="new-inspector" type="text" placeholder="Ù…ÙØªØ´ Ø¬Ø¯ÙŠØ¯">
      <button onclick="addInspector()">Ø¥Ø¶Ø§ÙØ©</button>
    </div>
  </div>
  <div class="section">
    <span class="label">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø·Ù‚:</span>
    <div id="areas"></div>
    <div class="add-box">
      <input id="new-area" type="text" placeholder="Ù…Ù†Ø·Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©">
      <button onclick="addArea()">Ø¥Ø¶Ø§ÙØ©</button>
    </div>
  </div>
  <div class="section shop-section">
    <span class="label">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</span>
    <div id="shops"></div>
    <div class="add-box">
      <select id="shop-area"></select>
      <input id="new-shop" type="text" placeholder="Ø§Ø³Ù… Ù…Ø­Ù„ Ø¬Ø¯ÙŠØ¯">
      <button onclick="addShop()">Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ù„</button>
    </div>
  </div>
  <div class="section">
    <span class="label">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙØªØ´ÙŠÙ† ÙˆØ§Ù„Ø£ÙŠØ§Ù…:</span>
    <div id="distribution"></div>
    <button class="save-btn" onclick="saveData()">Ø­ÙØ¸ Ø§Ù„Ø®Ø·Ø© (ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù)</button>
    <button class="upload-btn" onclick="saveAndUploadData()">Ø­ÙØ¸ ÙˆØ±ÙØ¹ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¥Ù„Ù‰ GitHub</button>
  </div>
  <div class="footer">ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ø¯. Ø¹Ù„ÙŠ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø§Ù„ | Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±ÙÙ‚ Ø¨Ø§Ù„Ø­ÙŠÙˆØ§Ù† - Ø¨Ù„Ø¯ÙŠØ© Ù…Ø¯ÙŠÙ†Ø© Ø£Ø¨ÙˆØ¸Ø¨Ù‰</div>
  <script>
    // âš ï¸ SECURITY NOTE: This is client-side authentication only!
    // For production use with sensitive data, implement server-side authentication.
    // Client-side checks can be bypassed via browser developer tools.
    
    // Check authentication - redirect if not authenticated
    (function() {
      const isAuthenticated = localStorage.getItem('smartPlannerAuth') === 'true';
      if (!isAuthenticated) {
        alert('âš ï¸ ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø°ÙƒÙŠØ©');
        window.location.href = 'smart-planner.html';
        return;
      }
      
      // Update navigation link visibility on page load
      window.addEventListener('DOMContentLoaded', function() {
        const STORAGE_KEY = "smartPlannerConfig";
        const config = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
        
        // Hide index link if it's not visible
        const indexLink = document.getElementById('link-index');
        if (indexLink) {
          const indexVisible = config['index'] !== undefined ? config['index'] : false;
          if (!indexVisible) {
            indexLink.style.display = 'none';
          }
        }
      });
    })();
    
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§)
    let inspectors = ["Ø¯. Ø¹Ù„ÙŠ Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø§Ù„Ùƒ", "Ø¯. Ù…Ø­Ù…Ø¯ Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„"];
    let areas = ["ÙˆØ³Ø· Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©", "Ø¬Ù†ÙˆØ¨"];
    let shopsByArea = {"ÙˆØ³Ø· Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©":["Ù…Ø­Ù„ Ø¹Ø§Ù… 1"], "Ø¬Ù†ÙˆØ¨":["Ù…Ø­Ù„ Ø¬Ù†ÙˆØ¨ 1"]};
    let distribution = [];

    // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙØªØ´ÙŠÙ† ---
    function renderInspectors() {
      let html = "";
      inspectors.forEach((inspector, i) => {
        html += `<span class="list-item">${inspector} <button class="del-btn" title="Ø­Ø°Ù" onclick="delInspector(${i})">Ã—</button></span>`;
      });
      document.getElementById("inspectors").innerHTML = html;
    }
    function addInspector() {
      let val = document.getElementById("new-inspector").value.trim();
      if(val && !inspectors.includes(val)) {
        inspectors.push(val);
        renderInspectors();
        document.getElementById("new-inspector").value = "";
        renderDistribution();
      }
    }
    function delInspector(i) {
      inspectors.splice(i,1);
      renderInspectors();
      renderDistribution();
    }

    // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ ---
    function renderAreas() {
      let html = "";
      areas.forEach((area, i) => {
        html += `<span class="list-item">${area} <button class="del-btn" title="Ø­Ø°Ù" onclick="delArea(${i})">Ã—</button></span>`;
      });
      document.getElementById("areas").innerHTML = html;
      renderShopAreaSelect();
    }
    function addArea() {
      let val = document.getElementById("new-area").value.trim();
      if(val && !areas.includes(val)) {
        areas.push(val); shopsByArea[val]=[];
        renderAreas(); renderShops();
        document.getElementById("new-area").value = "";
      }
    }
    function delArea(i) {
      let area = areas[i];
      areas.splice(i,1);
      delete shopsByArea[area];
      renderAreas(); renderShops();
      renderDistribution();
    }

    // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ù„Ø§Øª ---
    function renderShopAreaSelect() {
      let sel = document.getElementById("shop-area");
      sel.innerHTML = "";
      areas.forEach(area => {
        let opt = document.createElement("option");
        opt.value = area; opt.textContent = area;
        sel.appendChild(opt);
      });
    }
    function renderShops() {
      let html = "";
      areas.forEach(area => {
        html += `<strong>${area}:</strong> `;
        (shopsByArea[area]||[]).forEach((shop,i) => {
          html += `<span class="list-item">${shop} <button class="del-btn" title="Ø­Ø°Ù" onclick="delShop('${area}',${i})">Ã—</button></span>`;
        });
        html += "<br>";
      });
      document.getElementById("shops").innerHTML = html;
    }
    function addShop() {
      let area = document.getElementById("shop-area").value;
      let shop = document.getElementById("new-shop").value.trim();
      if(area && shop && !shopsByArea[area].includes(shop)) {
        shopsByArea[area].push(shop);
        renderShops();
        document.getElementById("new-shop").value = "";
        renderDistribution();
      }
    }
    function delShop(area,i) {
      shopsByArea[area].splice(i,1); renderShops(); renderDistribution();
    }

    // --- ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø­Ù„Ø§Øª ---
    function renderDistribution() {
      let html = `<table><tr><th>Ù…ÙØªØ´</th><th>Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th><th>Ø§Ù„Ù…Ø­Ù„</th><th>Ø­Ø°Ù</th></tr>`;
      distribution.forEach((row,i) => {
        html += `<tr>
          <td><select onchange="updateDist(${i},'inspector',this.value)">${inspectors.map(ins => `<option${row.inspector===ins?" selected":""}>${ins}</option>`)}</select></td>
          <td><input type="date" value="${row.day}" onchange="updateDist(${i},'day',this.value)"></td>
          <td><select onchange="updateDist(${i},'area',this.value)">${areas.map(ar => `<option${row.area===ar?" selected":""}>${ar}</option>`)}</select></td>
          <td><select onchange="updateDist(${i},'shop',this.value)">${(shopsByArea[row.area]||[]).map(shop => `<option${row.shop===shop?" selected":""}>${shop}</option>`)}</select></td>
          <td><button class="del-btn" title="Ø­Ø°Ù Ø§Ù„ØµÙ" onclick="delDistRow(${i})">Ã—</button></td>
        </tr>`;
      });
      html += `</table><button style="margin-top:8px;" onclick="addDistRow()">Ø¥Ø¶Ø§ÙØ© ØµÙ</button>`;
      document.getElementById("distribution").innerHTML = html;
    }
    function addDistRow() {
      distribution.push({inspector:inspectors[0]||"", day:"", area:areas[0]||"", shop:(shopsByArea[areas[0]]||[])[0]||""});
      renderDistribution();
    }
    function updateDist(i, field, value) {
      distribution[i][field]=value;
      if(field==="area") distribution[i].shop = (shopsByArea[value]||[])[0]||"";
      renderDistribution();
    }
    function delDistRow(i) {
      distribution.splice(i,1);
      renderDistribution();
    }

    // --- Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹ ---
    function saveData() {
      let plan = {
        inspectors: inspectors,
        areas: areas,
        shopsByArea: shopsByArea,
        distribution: distribution
      };
      let blob = new Blob([JSON.stringify(plan, null, 2)], {type:"application/json"});
      let url = URL.createObjectURL(blob);
      let a = document.createElement("a");
      a.href = url;
      a.download = "plan-data.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª! Ø¹Ù†Ø¯ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø£Ùˆ Ù…Ø´Ø§Ø±ÙƒØ© Ù…ÙƒØ§Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø³ÙŠÙ‚Ø±Ø£Ù‡ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙØªØ´ÙŠÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.");
    }

    // --- Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¥Ù„Ù‰ GitHub ---
    async function saveAndUploadData() {
      let plan = {
        inspectors: inspectors,
        areas: areas,
        shopsByArea: shopsByArea,
        distribution: distribution
      };
      await uploadPlanDataToGitHub(plan);
    }

    async function uploadPlanDataToGitHub(planData) {
      const owner = "aliabdelaal-adm";
      const repo = "inspection_plan";
      const path = "plan-data.json";
      const branch = "main";
      const token = "YOUR_PERSONAL_TOKEN"; // âš ï¸ Ø§Ø³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ

      let sha = "";
      let urlGet = `https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`;
      let resGet = await fetch(urlGet, {
        headers: { Authorization: `token ${token}` }
      });
      if (resGet.status === 200) {
        let data = await resGet.json();
        sha = data.sha;
      }
      let urlPut = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
      let resPut = await fetch(urlPut, {
        method: "PUT",
        headers: {
          "Authorization": `token ${token}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          message: "ØªØ­Ø¯ÙŠØ« plan-data.json ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©",
          content: btoa(unescape(encodeURIComponent(JSON.stringify(planData, null, 2)))),
          branch: branch,
          sha: sha || undefined
        })
      });

      if (resPut.status === 201 || resPut.status === 200) {
        alert("ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¥Ù„Ù‰ GitHub Ø¨Ù†Ø¬Ø§Ø­!");
      } else {
        let error = await resPut.json();
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹: " + (error.message || resPut.status));
      }
    }

    // --- Ø£ÙˆÙ„ ØªØ­Ù…ÙŠÙ„ Ù„Ù„ØªØµÙ…ÙŠÙ… ---
    renderInspectors();
    renderAreas();
    renderShopAreaSelect();
    renderShops();
    renderDistribution();
  </script>
</body>
</html>