<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</title>
  <style>
    body { font-family:'Segoe UI',Arial,sans-serif; background:#f6f6f6; margin:0; padding:0;}
    .container { max-width:950px; margin:40px auto; background:#fff; border-radius:10px; box-shadow:0 0 10px #bbb; padding:28px; direction:rtl;}
    .header { background:#2336a0; color:#fff; font-size:1.6em; text-align:center; padding:16px 0; border-radius:8px; margin-bottom:24px;}
    .section-title { background:#e2e6f6; font-size:1.17em; font-weight:bold; margin:22px 0 10px 0; padding:7px 0; border-radius:6px; text-align:right;}
    .section-title.red { color:#c00; }
    .between-tables-space {height:40px;}
    .copyright { text-align:center; color:#2336a0; font-weight:bold; margin-top:30px; font-size:1.1em;}
    .admin-section { background:#e2e6f6; border-radius:6px; padding:10px; margin-bottom:24px; }
    .list-item {display:inline-block; background:#2336a0; color:#fff; margin:2px; padding:4px 12px; border-radius:4px;}
    .del-btn {background:#c00; color:#fff; border:none; border-radius:50%; width:20px; height:20px; margin-right:7px; cursor:pointer;}
    .del-btn:hover {background:#a00;}
    .add-box {display:inline-block; margin-right:12px;}
    table {width:100%; border-collapse:collapse; background:#fafafa;}
    th,td {border:1px solid #bbb; padding:12px 6px; text-align:center; vertical-align:middle; font-size:1.09em;}
    th {background:#2336a0; color:#fff;}
    .goals-cell { text-align:right; background:#f3f7ff; color:#2336a0; font-weight:bold; font-size:1.09em;}
    .goals-red { color:#c00; font-weight:bold; }
    .goals-edit-label { font-size:1.12em; color:#2336a0; font-weight:bold; }
    .goals-edit-text {width:98%; padding:7px; font-size:1.09em; border-radius:6px; border:1px solid #bbb; background:#f3f7ff; color:#2336a0;}
    .print-btn, .save-btn { background:#2336a0; color:#fff; border:none; border-radius:4px; padding:8px 22px; font-size:1em; cursor:pointer; margin-bottom:12px; }
    .print-btn:hover, .save-btn:hover { background:#2a43c7; }
    .pw-popup { position: fixed; top: 0; right: 0; left:0; bottom:0; background: rgba(0,0,0,0.12); display: flex; align-items:center; justify-content:center; z-index:1000;}
    .pw-box { background:#fff; padding:30px 24px; border-radius:12px; box-shadow:0 6px 30px #aaa; min-width:320px; text-align:center;}
    .pw-box label { font-size:1.1em; color:#2336a0;}
    .pw-box input[type="password"] { font-size:1.1em; padding:7px; margin:12px 0; border:1px solid #ccc; border-radius:6px; width:96%;}
    .pw-box button { background:#2336a0; color:#fff; padding:9px 32px; font-size:1.1em; border-radius:8px; border:none; cursor:pointer; margin:0 4px;}
    .pw-box button:hover { background:#2a43c7;}
    .pw-error {color:#c00; margin-top:10px; font-weight:bold;}
    .stats-table {margin:16px auto 24px auto; border:1px solid #2336a0; border-radius:8px; background:#f7f7ff;}
    .stats-table th {background:#2336a0; color:#fff;}
    .stats-table td {background:#fff;}
    .stats-table tfoot td {background:#e2e6f6; font-weight:bold;}
    .stats-inspector-col {min-width:160px; width:160px;}
    .stats-total-cell { color:#c00; font-weight:bold;}
    .goals-edit-box {margin: 14px 0 14px 0;}
 copilot/fix-d800411c-398a-4581-8d5d-37d37b7f1c28
    .audio-overlay { position: fixed; top: 0; right: 0; left:0; bottom:0; background: rgba(0,0,0,0.7); display: flex; align-items:center; justify-content:center; z-index:2000; animation: fadeIn 0.3s;}
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
    .audio-box { background:#fff; padding:30px 24px; border-radius:12px; box-shadow:0 6px 30px #333; min-width:400px; text-align:center; animation: slideIn 0.4s;}
    @keyframes slideIn { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .audio-box h2 { color:#2336a0; margin-bottom: 20px; font-size: 1.4em;}
    .audio-box audio { width: 100%; margin: 20px 0; }
    .audio-box .close-btn { background:#c00; color:#fff; padding:10px 40px; font-size:1.1em; border-radius:8px; border:none; cursor:pointer; margin-top: 15px;}
    .audio-box .close-btn:hover { background:#a00;}
    @media print { .print-btn, .copyright, .admin-section, .save-btn, .pw-popup, .stats-table, .audio-overlay { display:none !important;} body { background:#fff; } .container { box-shadow:none; margin:0;} }

    @media print { .print-btn, .copyright, .admin-section, .save-btn, .pw-popup, .stats-table { display:none !important;} body { background:#fff; } .container { box-shadow:none; margin:0;} }
    /* Splash Screen Styles */
    .splash-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #2336a0 0%, #1e2a8a 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      cursor: pointer;
      animation: fadeIn 0.5s ease-in;
    }
    .splash-screen.fade-out {
      animation: fadeOut 0.5s ease-out forwards;
    }
    .splash-logo-container {
      text-align: center;
      animation: zoomIn 0.8s ease-out;
    }
    .splash-logo {
      max-width: 300px;
      max-height: 300px;
      width: 80%;
      height: auto;
      filter: drop-shadow(0 10px 30px rgba(0,0,0,0.3));
      animation: pulse 2s ease-in-out infinite;
    }
    .splash-title {
      color: #fff;
      font-size: 2em;
      margin-top: 30px;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    .splash-subtitle {
      color: #e2e6f6;
      font-size: 1.2em;
      margin-top: 10px;
    }
    .splash-hint {
      color: rgba(255,255,255,0.7);
      font-size: 0.9em;
      margin-top: 20px;
      animation: blink 2s ease-in-out infinite;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    @keyframes zoomIn {
      from { transform: scale(0.5); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    @keyframes blink {
      0%, 100% { opacity: 0.7; }
      50% { opacity: 1; }
    }
 main
  </style>
  <!-- SheetJS library for Excel file parsing -->
  <!-- If the CDN below is blocked, download from https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js and host locally -->
  <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
 copilot/fix-d800411c-398a-4581-8d5d-37d37b7f1c28
  <!-- Audio/Video Overlay -->
  <div id="audioOverlay" class="audio-overlay" style="display:none;">
    <div class="audio-box">
      <h2>ğŸ”Š Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ©</h2>
      <p>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</p>
      <audio id="welcomeAudio" controls autoplay>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
        Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
      </audio>
      <br>
      <button class="close-btn" onclick="closeAudioOverlay()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>

  <!-- Splash Screen -->
  <div id="splashScreen" class="splash-screen" onclick="hideSplashScreen()">
    <div class="splash-logo-container">
      <!-- Logo SVG - Can be replaced with an image -->
      <svg class="splash-logo" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#ffffff;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#e2e6f6;stop-opacity:1" />
          </linearGradient>
        </defs>
        <!-- Shield shape -->
        <path d="M100 10 L180 50 L180 120 Q180 160 100 190 Q20 160 20 120 L20 50 Z" 
              fill="url(#logoGradient)" stroke="#fff" stroke-width="3"/>
        <!-- Checkmark -->
        <path d="M60 100 L85 125 L140 70" 
              fill="none" stroke="#2336a0" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
        <!-- Stars -->
        <circle cx="50" cy="60" r="3" fill="#2336a0"/>
        <circle cx="150" cy="60" r="3" fill="#2336a0"/>
        <circle cx="100" cy="40" r="4" fill="#2336a0"/>
      </svg>
      <div class="splash-title">Ø¥Ø¯Ø§Ø±Ø© Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´</div>
      <div class="splash-subtitle">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„Ø´Ù‡Ø±ÙŠ</div>
      <div class="splash-hint">Ø§Ø¶ØºØ· ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</div>
    </div>
  </div>

 main
  <div class="container">
    <div class="header">Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</div>
    <div style="text-align:left; margin-bottom:12px;">
      <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: </label>
      <select id="userType" onchange="onUserTypeChange()">
        <option value="inspector">Ù…Ø´Ø§Ù‡Ø¯</option>
        <option value="developer">Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</option>
      </select>
    </div>
    <div id="pwPopup" class="pw-popup" style="display:none;">
      <div class="pw-box">
        <label>Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…:</label><br>
        <input id="pwInput" type="password" autocomplete="off" onkeypress="if(event.key==='Enter'){checkPassword();}">
        <br>
        <button onclick="checkPassword()">Ø¯Ø®ÙˆÙ„</button>
        <button onclick="cancelPassword()">Ø¥Ù„ØºØ§Ø¡</button>
        <div id="pwError" class="pw-error"></div>
      </div>
    </div>
    <div id="adminSection" class="admin-section" style="display:none;">
      <strong>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙØªØ´ÙŠÙ†:</strong>
      <div id="inspectors"></div>
      <div class="add-box">
        <input id="newInspector" type="text" placeholder="Ø§Ø³Ù… Ù…ÙØªØ´ Ø¬Ø¯ÙŠØ¯">
        <button onclick="addInspector()">Ø¥Ø¶Ø§ÙØ© Ù…ÙØªØ´</button>
      </div>
      <hr>
      <strong>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø·Ù‚:</strong>
      <div id="areas"></div>
      <div class="add-box">
        <input id="newArea" type="text" placeholder="Ù…Ù†Ø·Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©">
        <button onclick="addArea()">Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚Ø©</button>
      </div>
      <hr>
      <strong>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</strong>
      <div id="shops"></div>
      <div class="add-box">
        <select id="shopArea"></select>
        <input id="newShop" type="text" placeholder="Ø§Ø³Ù… Ù…Ø­Ù„ Ø¬Ø¯ÙŠØ¯">
        <button onclick="addShop()">Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ù„</button>
      </div>
      <hr>
      <strong>Ø±ÙØ¹ Ù…Ù„Ù Excel:</strong>
      <div style="margin: 10px 0;">
        <input type="file" id="excelFileInput" accept=".xlsx,.xls" style="display:none;" onchange="handleExcelUpload(event)">
        <button class="save-btn" onclick="document.getElementById('excelFileInput').click()">ğŸ“ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Excel</button>
        <span id="uploadStatus" style="margin-right: 10px; color: #2336a0; font-weight: bold;"></span>
      </div>
      <hr>
      <strong>Ø¥Ø¯Ø§Ø±Ø© Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´:</strong>
      <div id="distribution"></div>
      <button class="save-btn" onclick="savePlan()">Ø­ÙØ¸ Ø§Ù„Ø®Ø·Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
      <hr>
      <strong class="goals-edit-label">Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ØªÙØªÙŠØ´ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±:</strong>
      <div class="goals-edit-box">
        <textarea id="goalsEdit" class="goals-edit-text" rows="3"></textarea><br>
        <button class="goals-save-btn" onclick="saveGoals()">Ø­ÙØ¸ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù</button>
      </div>
    </div>
    <button class="print-btn" onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø© Ø£Ùˆ Ø­ÙØ¸ PDF</button>
    <button class="print-btn" onclick="openProfessionalReport()" style="background: linear-gradient(135deg, #d83b01 0%, #c13100 100%); margin-left: 10px;">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ø­ØªØ±Ø§ÙÙŠ PowerPoint/Excel</button>
    <div class="section-title red">Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØªÙŠØ´</div>
    <div id="planTable"></div>
    <div class="between-tables-space"></div>
    <div class="section-title red">Ø§Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙØªÙŠØ´</div>
    <div id="stats"></div>
    <div class="copyright">
      Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© &copy; Ø§Ù„Ù…Ø·ÙˆØ± Ø¯. Ø¹Ù„ÙŠ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø§Ù„
    </div>
  </div>
  <script>
    const DEVELOPER_PASSWORD = "1940";
    let isDevAuthorized = false;
    let inspectors = [], areas = [], shopsByArea = {}, distribution = [], goals = "";
    let autoReloadTimer = null;

    // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub (Ù…Ù„Ù plan-data.json)
    async function loadData(render=true) {
      try {
        let res = await fetch('https://raw.githubusercontent.com/aliabdelaal-adm/inspection_plan/main/plan-data.json?' + Date.now());
        let data = await res.json();
        inspectors = data.inspectors || [];
        areas = data.areas || [];
        shopsByArea = data.shopsByArea || {};
        distribution = data.distribution || [];
        goals = data.goals || "";
        if(render) renderAll();
      } catch (e) {
        alert("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…!");
      }
    }

    // Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© (ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„ÙˆÙ‚Øª Ø¨Ø§Ù„Ø£Ø³ÙÙ„)
    function startAutoReload() {
      if(autoReloadTimer) clearInterval(autoReloadTimer);
      autoReloadTimer = setInterval(function() {
        loadData(true);
      }, 60000); // 60000ms = 1 Ø¯Ù‚ÙŠÙ‚Ø©
    }

    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù…Ù„Ù plan-data.json (Ù„Ù„ØªÙ†Ø²ÙŠÙ„ ÙÙ‚Ø·)
    function savePlan() {
      let plan = {
        inspectors, areas, shopsByArea, distribution, goals
      };
      let blob = new Blob([JSON.stringify(plan, null, 2)], {type:"application/json"});
      let url = URL.createObjectURL(blob);
      let a = document.createElement("a");
      a.href = url;
      a.download = "plan-data.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø®Ø·Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø²! Ø³ÙŠØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³ÙƒØ±Ø¨Øª ÙŠØ¹Ù…Ù„.");
    }

    function onUserTypeChange() {
      let userType = document.getElementById("userType").value;
      if(userType==="developer" && !isDevAuthorized) {
        document.getElementById("pwPopup").style.display = "flex";
        document.getElementById("pwInput").value = "";
        document.getElementById("pwInput").focus();
        document.getElementById("pwError").textContent = "";
        document.getElementById("adminSection").style.display = "none";
      } else if(userType==="developer" && isDevAuthorized) {
        document.getElementById("adminSection").style.display = "block";
        document.getElementById("goalsEdit").value = goals;
        renderAll();
      } else {
        document.getElementById("adminSection").style.display = "none";
      }
      renderPlanTable();
      renderStats();
    }
    function checkPassword() {
      let pw = document.getElementById("pwInput").value;
      if(pw === DEVELOPER_PASSWORD) {
        isDevAuthorized = true;
        document.getElementById("pwPopup").style.display = "none";
        document.getElementById("adminSection").style.display = "block";
        document.getElementById("goalsEdit").value = goals;
        renderAll();
      } else {
        document.getElementById("pwError").textContent = "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!";
        document.getElementById("pwInput").focus();
      }
    }
    function cancelPassword() {
      document.getElementById("pwPopup").style.display = "none";
      document.getElementById("userType").value = "inspector";
      document.getElementById("adminSection").style.display = "none";
      isDevAuthorized = false;
      renderPlanTable();
      renderStats();
    }

    function renderInspectors() {
      let html = "";
      inspectors.forEach((inspector, i) => {
        html += `<span class="list-item">${inspector} <button class="del-btn" onclick="delInspector(${i})">Ã—</button></span>`;
      });
      document.getElementById("inspectors").innerHTML = html;
    }
    function addInspector() {
      let val = document.getElementById("newInspector").value.trim();
      if(val && !inspectors.includes(val)) {
        inspectors.push(val);
        renderInspectors();
        document.getElementById("newInspector").value = "";
        renderDistribution();
        renderPlanTable();
        renderStats();
      }
    }
    function delInspector(i) {
      inspectors.splice(i,1);
      renderInspectors();
      renderDistribution();
      renderPlanTable();
      renderStats();
    }
    function renderAreas() {
      let html = "";
      areas.forEach((area, i) => {
        html += `<span class="list-item">${area} <button class="del-btn" onclick="delArea(${i})">Ã—</button></span>`;
      });
      document.getElementById("areas").innerHTML = html;
      renderShopAreaSelect();
    }
    function addArea() {
      let val = document.getElementById("newArea").value.trim();
      if(val && !areas.includes(val)) {
        areas.push(val); shopsByArea[val]=[];
        renderAreas(); renderShops(); renderShopAreaSelect();
      }
    }
    function delArea(i) {
      let area = areas[i];
      areas.splice(i,1);
      delete shopsByArea[area];
      renderAreas(); renderShops(); renderShopAreaSelect();
    }
    function renderShopAreaSelect() {
      let sel = document.getElementById("shopArea");
      sel.innerHTML = "";
      areas.forEach(area => {
        let opt = document.createElement("option");
        opt.value = area; opt.textContent = area;
        sel.appendChild(opt);
      });
    }
    function renderShops() {
      let html = "";
      areas.forEach(area => {
        html += `<strong>${area}:</strong> `;
        (shopsByArea[area]||[]).forEach((shop,i) => {
          html += `<span class="list-item">${shop} <button class="del-btn" onclick="delShop('${area}',${i})">Ã—</button></span>`;
        });
        html += "<br>";
      });
      document.getElementById("shops").innerHTML = html;
    }
    function addShop() {
      let area = document.getElementById("shopArea").value;
      let shop = document.getElementById("newShop").value.trim();
      if(area && shop && !shopsByArea[area].includes(shop)) {
        shopsByArea[area].push(shop);
        document.getElementById("newShop").value = "";
        distribution.forEach((row,i)=>{
          if(row.area === area) row.shops = [...shopsByArea[area]];
        });
        renderShops();
        renderDistribution();
        renderPlanTable();
        renderStats();
      }
    }
    function delShop(area,i) {
      shopsByArea[area].splice(i,1); 
      distribution.forEach((row)=>{
        if(row.area === area) row.shops = row.shops.filter(shop => shopsByArea[area].includes(shop));
      });
      renderShops();
      renderDistribution();
      renderPlanTable();
      renderStats();
    }
    function renderDistribution() {
      let userType = document.getElementById("userType").value;
      let html = `<table><tr>
        <th>Ù…ÙØªØ´</th>
        <th>Ø§Ù„ÙŠÙˆÙ…</th>
        <th>ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø©</th>
        <th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
        <th>Ø§Ù„Ù…Ø­Ù„Ø§Øª</th>
        <th>Ø­Ø°Ù</th>
      </tr>`;
      distribution.forEach((row,i) => {
        let inspectorCell = (userType === "developer" && isDevAuthorized)
          ? `<select onchange="updateDist(${i},'inspector',this.value)">
              ${inspectors.map(ins => `<option${row.inspector===ins?" selected":""}>${ins}</option>`).join("")}
            </select>`
          : row.inspector;
        let shiftCell = (userType === "developer" && isDevAuthorized)
          ? `<select onchange="updateDist(${i},'shift',this.value)">
              <option${row.shift==="ØµØ¨Ø§Ø­ÙŠØ©"?" selected":""}>ØµØ¨Ø§Ø­ÙŠØ©</option>
              <option${row.shift==="Ù…Ø³Ø§Ø¦ÙŠØ©"?" selected":""}>Ù…Ø³Ø§Ø¦ÙŠØ©</option>
            </select>`
          : (row.shift || "");
        html += `<tr>
          <td>${inspectorCell}</td>
          <td><input type="date" value="${row.day}" onchange="updateDist(${i},'day',this.value)"></td>
          <td>${shiftCell}</td>
          <td><select onchange="updateDist(${i},'area',this.value)">${areas.map(ar => `<option${row.area===ar?" selected":""}>${ar}</option>`).join("")}</select></td>
          <td>${(row.shops||[]).join("ØŒ ")}</td>
          <td><button class="del-btn" onclick="delDistRow(${i})">Ã—</button></td>
        </tr>`;
      });
      html += `</table><button onclick="addDistRow()">Ø¥Ø¶Ø§ÙØ© ØµÙ</button>`;
      document.getElementById("distribution").innerHTML = html;
    }
    function addDistRow() {
      distribution.push({inspector:inspectors[0]||"", day:"", shift:"ØµØ¨Ø§Ø­ÙŠØ©", area:areas[0]||"", shops:[...(shopsByArea[areas[0]]||[])]});
      renderDistribution();
      renderPlanTable();
      renderStats();
    }
    function updateDist(i, field, value) {
      distribution[i][field]=value;
      if(field==="area") {
        distribution[i].shops = [...(shopsByArea[value]||[])];
      }
      renderDistribution();
      renderPlanTable();
      renderStats();
    }
    function delDistRow(i) {
      distribution.splice(i,1);
      renderDistribution();
      renderPlanTable();
      renderStats();
    }
    function saveGoals() {
      let newGoals = document.getElementById("goalsEdit").value.trim();
      if (newGoals) {
        goals = newGoals;
        renderPlanTable();
        renderStats();
        alert("ØªÙ… Ø­ÙØ¸ Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ØªÙØªÙŠØ´ Ø¨Ù†Ø¬Ø§Ø­! Ù„Ø§ ØªÙ†Ø³ Ø­ÙØ¸ Ø§Ù„Ø®Ø·Ø© ÙˆØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù.");
      }
    }
    function renderStats() {
      let inspectorShopCounts = {};
      let morningCounts = {};
      let eveningCounts = {};
      let weekendCounts = {};

      inspectors.forEach(inspector => {
        inspectorShopCounts[inspector] = 0;
        morningCounts[inspector] = 0;
        eveningCounts[inspector] = 0;
        weekendCounts[inspector] = 0;
      });

      distribution.forEach(row => {
        if (!row.inspector || !inspectors.includes(row.inspector)) return;
        let shopsCount = row.shops ? row.shops.length : 0;
        let shift = row.shift || "";
        let inspector = row.inspector;
        let dayStr = row.day;
        let isWeekend = false;
        if (dayStr) {
          let d = new Date(dayStr);
          let dayOfWeek = d.getDay();
          if (dayOfWeek === 5 || dayOfWeek === 6 || dayOfWeek === 0) isWeekend = true;
        }
        inspectorShopCounts[inspector] += shopsCount;
        if (shift === "ØµØ¨Ø§Ø­ÙŠØ©") morningCounts[inspector] += shopsCount;
        if (shift === "Ù…Ø³Ø§Ø¦ÙŠØ©") eveningCounts[inspector] += shopsCount;
        if (isWeekend) weekendCounts[inspector] += shopsCount;
      });

      let html = `<table class="stats-table">
        <thead>
          <tr>
            <th class="stats-inspector-col">Ø§Ø³Ù… Ø§Ù„Ù…ÙØªØ´</th>
            <th>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙØªÙŠØ´Ø§Øª (ÙƒÙ„ Ø§Ù„Ø´Ù‡Ø±)</th>
            <th>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙØªÙŠØ´Ø§Øª Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ©</th>
            <th>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙØªÙŠØ´Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠØ©</th>
            <th>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙØªÙŠØ´Ø§Øª ÙÙŠ Ø§Ù„Ø¹Ø·Ù„Ø© (Ø¬Ù…Ø¹Ø©/Ø³Ø¨Øª/Ø£Ø­Ø¯)</th>
          </tr>
        </thead>
        <tbody>`;
      inspectors.forEach(name => {
        html += `<tr>
          <td class="stats-inspector-col">${name}</td>
          <td>${inspectorShopCounts[name]}</td>
          <td>${morningCounts[name]}</td>
          <td>${eveningCounts[name]}</td>
          <td>${weekendCounts[name]}</td>
        </tr>`;
      });
      html += `</tbody>
        <tfoot>
          <tr>
            <td class="stats-total-cell">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªÙØªÙŠØ´</td>
            <td class="stats-total-cell">${Object.values(inspectorShopCounts).reduce((a,b)=>a+b,0)}</td>
            <td class="stats-total-cell">${Object.values(morningCounts).reduce((a,b)=>a+b,0)}</td>
            <td class="stats-total-cell">${Object.values(eveningCounts).reduce((a,b)=>a+b,0)}</td>
            <td class="stats-total-cell">${Object.values(weekendCounts).reduce((a,b)=>a+b,0)}</td>
          </tr>
        </tfoot>
      </table>`;
      document.getElementById("stats").innerHTML = html;
    }
    function renderPlanTable() {
      let userType = document.getElementById("userType").value;
      let html = `<table>
        <thead>
          <tr>
            <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙØªØ´</th>
            <th>Ø§Ù„ÙŠÙˆÙ…</th>
            <th>ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø©</th>
            <th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
            <th>Ø§Ù„Ù…Ø­Ù„Ø§Øª</th>
          </tr>
        </thead>
        <tbody>
      `;
      distribution.forEach((row, idx) => {
        let inspectorCell = (userType === "developer" && isDevAuthorized)
          ? `<select onchange="updateDist(${idx},'inspector',this.value)">
              ${inspectors.map(ins => `<option${row.inspector===ins?" selected":""}>${ins}</option>`).join("")}
            </select>`
          : row.inspector;
        html += `<tr>
          <td>${inspectorCell}</td>
          <td>${row.day}</td>
          <td>${row.shift || ""}</td>
          <td>${row.area}</td>
          <td>${(row.shops||[]).join("ØŒ ")}</td>
        </tr>`;
      });
      html += `</tbody>
        <tfoot>
          <tr>
            <td class="goals-cell" colspan="5">
              <span class="goals-red">Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ØªÙØªÙŠØ´ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±:</span><br>
              <span>${goals.replace(/\n/g, "<br>")}</span>
            </td>
          </tr>
        </tfoot>
      </table>`;
      document.getElementById("planTable").innerHTML = html;
    }
    function renderAll() {
      renderInspectors();
      renderAreas();
      renderShops();
      renderShopAreaSelect();
      renderDistribution();
      renderPlanTable();
      renderStats();
      document.getElementById("goalsEdit").value = goals;
    }
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ØªØ­Ù…ÙŠÙ„
    loadData();
    startAutoReload();
    
    // Audio overlay functions
    function showAudioOverlay() {
      const overlay = document.getElementById('audioOverlay');
      const audio = document.getElementById('welcomeAudio');
      
      // Show overlay
      overlay.style.display = 'flex';
      
      // Auto-close when audio ends
      audio.addEventListener('ended', function() {
        closeAudioOverlay();
      });
      
      // Try to play audio (some browsers require user interaction)
      audio.play().catch(function(error) {
        console.log('Auto-play prevented:', error);
      });
    }
    
    function closeAudioOverlay() {
      const overlay = document.getElementById('audioOverlay');
      const audio = document.getElementById('welcomeAudio');
      
      // Fade out animation
      overlay.style.animation = 'fadeOut 0.3s';
      
      setTimeout(function() {
        overlay.style.display = 'none';
        overlay.style.animation = 'fadeIn 0.3s';
        audio.pause();
        audio.currentTime = 0;
      }, 300);
    }
    
    // Show audio overlay on page load
    window.addEventListener('load', function() {
      setTimeout(function() {
        showAudioOverlay();
      }, 500); // Delay 0.5 seconds after page load
    });
    
    // Excel file upload handler
    function handleExcelUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      // Check if XLSX library is loaded
      if (typeof XLSX === 'undefined') {
        alert('Ù…ÙƒØªØ¨Ø© Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„ÙØ§Øª Excel ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ù…Ø­Ù„ÙŠØ§Ù‹.');
        return;
      }
      
      const statusElement = document.getElementById('uploadStatus');
      statusElement.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù...';
      statusElement.style.color = '#2336a0';
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, {type: 'array'});
          
          // Parse the Excel file and extract data
          parseExcelData(workbook);
          
          statusElement.textContent = 'âœ“ ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­!';
          statusElement.style.color = '#0a0';
          
          // Render all components with the new data
          renderAll();
          
          // Clear the file input for future uploads
          event.target.value = '';
          
          setTimeout(() => {
            statusElement.textContent = '';
          }, 3000);
          
        } catch (error) {
          console.error('Excel parsing error:', error);
          statusElement.textContent = 'âœ— Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù!';
          statusElement.style.color = '#c00';
          alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Excel. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù„Ù.');
        }
      };
      
      reader.onerror = function() {
        statusElement.textContent = 'âœ— Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù!';
        statusElement.style.color = '#c00';
      };
      
      reader.readAsArrayBuffer(file);
    }
    
    // Parse Excel data and map to application structure
    function parseExcelData(workbook) {
      // Expected Excel structure:
      // Sheet 1 (Ø§Ù„Ù…ÙØªØ´ÙŠÙ†): Column A contains inspector names
      // Sheet 2 (Ø§Ù„Ù…Ù†Ø§Ø·Ù‚): Column A contains area names
      // Sheet 3 (Ø§Ù„Ù…Ø­Ù„Ø§Øª): Column A contains area names, Column B contains shop names
      // Sheet 4 (Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´): Columns: Ø§Ù„Ù…ÙØªØ´, Ø§Ù„ÙŠÙˆÙ…, ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø©, Ø§Ù„Ù…Ù†Ø·Ù‚Ø©, Ø§Ù„Ù…Ø­Ù„Ø§Øª
      // Sheet 5 (Ø§Ù„Ø£Ù‡Ø¯Ø§Ù): Goals text
      
      const sheetNames = workbook.SheetNames;
      
      // Parse Inspectors (Sheet 1 or find by name)
      let inspectorsSheet = workbook.Sheets[sheetNames[0]];
      if (sheetNames.includes('Ø§Ù„Ù…ÙØªØ´ÙŠÙ†') || sheetNames.includes('Inspectors')) {
        inspectorsSheet = workbook.Sheets[sheetNames.includes('Ø§Ù„Ù…ÙØªØ´ÙŠÙ†') ? 'Ø§Ù„Ù…ÙØªØ´ÙŠÙ†' : 'Inspectors'];
      }
      if (inspectorsSheet) {
        const inspectorsData = XLSX.utils.sheet_to_json(inspectorsSheet, {header: 1});
        inspectors = inspectorsData.filter(row => row[0] && row[0].toString().trim()).map(row => row[0].toString().trim());
      }
      
      // Parse Areas (Sheet 2 or find by name)
      if (sheetNames.length > 1) {
        let areasSheet = workbook.Sheets[sheetNames[1]];
        if (sheetNames.includes('Ø§Ù„Ù…Ù†Ø§Ø·Ù‚') || sheetNames.includes('Areas')) {
          areasSheet = workbook.Sheets[sheetNames.includes('Ø§Ù„Ù…Ù†Ø§Ø·Ù‚') ? 'Ø§Ù„Ù…Ù†Ø§Ø·Ù‚' : 'Areas'];
        }
        if (areasSheet) {
          const areasData = XLSX.utils.sheet_to_json(areasSheet, {header: 1});
          areas = areasData.filter(row => row[0] && row[0].toString().trim()).map(row => row[0].toString().trim());
        }
      }
      
      // Parse Shops by Area (Sheet 3 or find by name)
      if (sheetNames.length > 2) {
        let shopsSheet = workbook.Sheets[sheetNames[2]];
        if (sheetNames.includes('Ø§Ù„Ù…Ø­Ù„Ø§Øª') || sheetNames.includes('Shops')) {
          shopsSheet = workbook.Sheets[sheetNames.includes('Ø§Ù„Ù…Ø­Ù„Ø§Øª') ? 'Ø§Ù„Ù…Ø­Ù„Ø§Øª' : 'Shops'];
        }
        if (shopsSheet) {
          const shopsData = XLSX.utils.sheet_to_json(shopsSheet, {header: 1});
          shopsByArea = {};
          shopsData.forEach(row => {
            if (row[0] && row[1]) {
              const area = row[0].toString().trim();
              const shop = row[1].toString().trim();
              if (!shopsByArea[area]) {
                shopsByArea[area] = [];
              }
              if (!shopsByArea[area].includes(shop)) {
                shopsByArea[area].push(shop);
              }
            }
          });
        }
      }
      
      // Parse Distribution (Sheet 4 or find by name)
      if (sheetNames.length > 3) {
        let distributionSheet = workbook.Sheets[sheetNames[3]];
        if (sheetNames.includes('Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´') || sheetNames.includes('Distribution')) {
          distributionSheet = workbook.Sheets[sheetNames.includes('Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´') ? 'Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´' : 'Distribution'];
        }
        if (distributionSheet) {
          const distributionData = XLSX.utils.sheet_to_json(distributionSheet, {header: 1});
          distribution = [];
          // Skip header row (index 0)
          for (let i = 1; i < distributionData.length; i++) {
            const row = distributionData[i];
            if (row[0] && row[1] && row[2] && row[3]) {
              const shops = row[4] ? row[4].toString().split(/[,;ØŒ]/).map(s => s.trim()).filter(s => s) : [];
              distribution.push({
                inspector: row[0].toString().trim(),
                day: row[1].toString().trim(),
                shift: row[2].toString().trim(),
                area: row[3].toString().trim(),
                shops: shops
              });
            }
          }
        }
      }
      
      // Parse Goals (Sheet 5 or find by name)
      if (sheetNames.length > 4) {
        let goalsSheet = workbook.Sheets[sheetNames[4]];
        if (sheetNames.includes('Ø§Ù„Ø£Ù‡Ø¯Ø§Ù') || sheetNames.includes('Goals')) {
          goalsSheet = workbook.Sheets[sheetNames.includes('Ø§Ù„Ø£Ù‡Ø¯Ø§Ù') ? 'Ø§Ù„Ø£Ù‡Ø¯Ø§Ù' : 'Goals'];
        }
        if (goalsSheet) {
          const goalsData = XLSX.utils.sheet_to_json(goalsSheet, {header: 1});
          goals = goalsData.map(row => row[0] ? row[0].toString() : '').join('\n');
        }
      }
      
      // Initialize empty areas in shopsByArea if needed
      areas.forEach(area => {
        if (!shopsByArea[area]) {
          shopsByArea[area] = [];
        }
      });
    }
    
    // Professional Report Integration
    window.openProfessionalReport = function() {
      // Save current data to localStorage for the professional report
      const currentData = {
        inspectors: inspectors,
        areas: areas,
        shopsByArea: shopsByArea,
        distribution: distribution,
        goals: goals
      };
      localStorage.setItem('inspectionPlanData', JSON.stringify(currentData));
      
      // Open professional report in new tab
      window.open('professional-report-template.html', '_blank');
    };

    // Splash Screen functionality
    function hideSplashScreen() {
      const splashScreen = document.getElementById('splashScreen');
      if (splashScreen) {
        splashScreen.classList.add('fade-out');
        setTimeout(() => {
          splashScreen.style.display = 'none';
        }, 500); // Match the fadeOut animation duration
      }
    }

    // Auto-hide splash screen after 10 seconds
    setTimeout(() => {
      hideSplashScreen();
    }, 10000);
  </script>
</body>
</html>