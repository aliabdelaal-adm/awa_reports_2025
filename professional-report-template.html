<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù‚Ø§Ù„Ø¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ - Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</title>
  <!-- External libraries will be loaded dynamically when needed -->
  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, Arial, Helvetica, sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0; 
      padding: 20px;
      direction: rtl;
    }
    
    .report-container { 
      max-width: 1200px; 
      margin: 0 auto; 
      background: #fff; 
      border-radius: 15px; 
      box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
      overflow: hidden;
    }
    
    .header-section {
      background: linear-gradient(135deg, #2336a0 0%, #1e2a8a 100%);
      color: white;
      padding: 30px;
      text-align: center;
      position: relative;
    }
    
    .header-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" patternUnits="userSpaceOnUse" width="100" height="100"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    }
    
    .header-content {
      position: relative;
      z-index: 1;
    }
    
    .main-title {
      font-size: 2.5em;
      font-weight: bold;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .subtitle {
      font-size: 1.2em;
      opacity: 0.9;
      margin-bottom: 20px;
    }
    
    .report-date {
      background: rgba(255,255,255,0.2);
      padding: 10px 20px;
      border-radius: 25px;
      display: inline-block;
      font-weight: bold;
    }
    
    .content-section {
      padding: 40px;
    }
    
    .section-header {
      background: linear-gradient(135deg, #e2e6f6 0%, #f0f2ff 100%);
      color: #2336a0;
      font-size: 1.4em;
      font-weight: bold;
      padding: 15px 25px;
      margin: 30px 0 20px 0;
      border-radius: 10px;
      border-left: 5px solid #2336a0;
      box-shadow: 0 2px 10px rgba(35, 54, 160, 0.1);
    }
    
    .data-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin: 30px 0;
    }
    
    .data-card {
      background: #f8f9ff;
      border-radius: 12px;
      padding: 25px;
      border: 1px solid #e2e6f6;
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
      transition: transform 0.3s ease;
    }
    
    .data-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }
    
    .card-title {
      color: #2336a0;
      font-weight: bold;
      font-size: 1.2em;
      margin-bottom: 15px;
      border-bottom: 2px solid #2336a0;
      padding-bottom: 8px;
    }
    
    .professional-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .professional-table th {
      background: linear-gradient(135deg, #2336a0 0%, #1e2a8a 100%);
      color: white;
      padding: 15px 10px;
      text-align: center;
      font-weight: bold;
      position: relative;
    }
    
    .professional-table th::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent 0%, white 50%, transparent 100%);
    }
    
    .professional-table td {
      padding: 12px 10px;
      text-align: center;
      border-bottom: 1px solid #e2e6f6;
      transition: background-color 0.3s ease;
    }
    
    .professional-table tbody tr:hover {
      background-color: #f0f2ff;
    }
    
    .professional-table tbody tr:nth-child(even) {
      background-color: #fafbff;
    }
    
    .stats-section {
      background: linear-gradient(135deg, #f8f9ff 0%, #e2e6f6 100%);
      padding: 30px;
      border-radius: 15px;
      margin: 30px 0;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .stat-item {
      background: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .stat-number {
      font-size: 2.5em;
      font-weight: bold;
      color: #2336a0;
      margin-bottom: 5px;
    }
    
    .stat-label {
      color: #666;
      font-size: 0.9em;
    }
    
    .export-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      padding: 30px;
      background: #f8f9ff;
      border-radius: 15px;
      margin: 30px 0;
    }
    
    .export-btn {
      background: linear-gradient(135deg, #2336a0 0%, #1e2a8a 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 25px;
      font-size: 1.1em;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(35, 54, 160, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .export-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    
    .export-btn:hover::before {
      left: 100%;
    }
    
    .export-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(35, 54, 160, 0.4);
    }
    
    .export-btn.powerpoint {
      background: linear-gradient(135deg, #d83b01 0%, #c13100 100%);
      box-shadow: 0 4px 15px rgba(216, 59, 1, 0.3);
    }
    
    .export-btn.excel {
      background: linear-gradient(135deg, #217346 0%, #1e5f3a 100%);
      box-shadow: 0 4px 15px rgba(33, 115, 70, 0.3);
    }
    
    .export-btn.word {
      background: linear-gradient(135deg, #2b579a 0%, #1f4788 100%);
      box-shadow: 0 4px 15px rgba(43, 87, 154, 0.3);
    }
    
    .chart-container {
      background: white;
      padding: 30px;
      border-radius: 15px;
      margin: 30px 0;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .loading {
      text-align: center;
      color: #2336a0;
      font-weight: bold;
      padding: 20px;
    }
    
    .success-message {
      background: #d4edda;
      color: #155724;
      padding: 15px;
      border-radius: 10px;
      margin: 15px 0;
      text-align: center;
      font-weight: bold;
    }
    
    @media print {
      body { background: white; }
      .export-buttons { display: none; }
      .report-container { box-shadow: none; }
    }
    
    @media (max-width: 768px) {
      .data-grid { grid-template-columns: 1fr; }
      .export-buttons { flex-direction: column; align-items: center; }
      .main-title { font-size: 2em; }
      .content-section { padding: 20px; }
    }
  </style>
</head>
<body>
  <div class="report-container">
    <div class="header-section">
      <div class="header-content">
        <div class="main-title">ØªÙ‚Ø±ÙŠØ± Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</div>
        <div class="subtitle">ØªÙ‚Ø±ÙŠØ± Ø§Ø­ØªØ±Ø§ÙÙŠ Ø´Ø§Ù…Ù„ Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´</div>
        <div class="report-date" id="reportDate"></div>
      </div>
    </div>
    
    <div class="content-section">
      <div class="export-buttons">
        <button class="export-btn powerpoint" onclick="exportToPowerPoint()">
          ğŸ“Š ØªØµØ¯ÙŠØ± PowerPoint
        </button>
        <button class="export-btn excel" onclick="exportToExcel()">
          ğŸ“ˆ ØªØµØ¯ÙŠØ± Excel
        </button>
        <button class="export-btn word" onclick="exportToWord()">
          ğŸ“„ ØªØµØ¯ÙŠØ± Word
        </button>
        <button class="export-btn" onclick="exportToPDF()">
          ğŸ“‹ ØªØµØ¯ÙŠØ± PDF
        </button>
        <button class="export-btn" onclick="window.print()">
          ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©
        </button>
      </div>
      
      <div id="loadingMessage" class="loading" style="display: none;">
        Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ...
      </div>
      
      <div id="successMessage" class="success-message" style="display: none;"></div>
      
      <div class="section-header">ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ù…Ø© Ø¹Ù† Ø§Ù„Ø®Ø·Ø©</div>
      <div class="data-grid">
        <div class="data-card">
          <div class="card-title">Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ØªÙØªÙŠØ´</div>
          <div id="goalsContent"></div>
        </div>
        <div class="data-card">
          <div class="card-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ±</div>
          <div>
            <strong>ØªØ§Ø±ÙŠØ® Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±:</strong> <span id="creationDate"></span><br>
            <strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙØªØ´ÙŠÙ†:</strong> <span id="inspectorCount"></span><br>
            <strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚:</strong> <span id="areaCount"></span><br>
            <strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ù„Ø§Øª:</strong> <span id="totalShops"></span>
          </div>
        </div>
      </div>
      
      <div class="section-header">ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØªØ´ÙŠÙ†</div>
      <div id="inspectorsList"></div>
      
      <div class="section-header">ğŸ—ºï¸ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ ÙˆØ§Ù„Ù…Ø­Ù„Ø§Øª</div>
      <div id="areasAndShops"></div>
      
      <div class="section-header">ğŸ“… Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</div>
      <div id="inspectionTable"></div>
      
      <div class="section-header">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</div>
      <div class="stats-section">
        <div class="stats-grid" id="statsGrid"></div>
        <div class="chart-container">
          <canvas id="inspectionChart" width="400" height="200"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script>
    let inspectionData = {
      inspectors: [],
      areas: [],
      shopsByArea: {},
      distribution: [],
      goals: ""
    };

    // Load data from local storage or use demo data
    function loadInspectionData() {
      try {
        // Try to get data from localStorage first (from main app)
        const localData = localStorage.getItem('inspectionPlanData');
        if (localData) {
          inspectionData = JSON.parse(localData);
        } else {
          // Use demo data for demonstration
          inspectionData = {
            inspectors: [
              "Ø¯. Ø¹Ù„ÙŠ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø§Ù„", 
              "Ø¯. Ù…Ø­Ù…Ø¯ Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„", 
              "Ø¯. ÙØ§ÙŠØ² Ø§Ù„Ù…Ø³Ø§Ù„Ù…Ø©",
              "Ø¯. Ù…Ø­Ù…Ø¯ Ø³Ø¹ÙŠØ¯",
              "Ø¯. Ø¢ÙŠÙ‡ Ø³Ù„Ø§Ù…Ø©",
              "Ø¯. Ø¢Ù…Ù†Ù‡ Ø¨Ù† ØµØ±Ù…"
            ],
            areas: ["Ø³ÙˆÙ‚ Ø§Ù„Ø·ÙŠÙˆØ±", "Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©", "Ø§Ù„ÙˆØ«Ø¨Ø© Ø¬Ù†ÙˆØ¨", "Ù…Ø¯ÙŠÙ†Ø© Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø²Ø§ÙŠØ¯", "Ù…Ø¯ÙŠÙ†Ø© Ø®Ù„ÙŠÙØ©"],
            shopsByArea: {
              "Ø³ÙˆÙ‚ Ø§Ù„Ø·ÙŠÙˆØ±": ["Ù…Ø­Ù„ Ø§Ù„ÙŠØ§Ù‚ÙˆØª", "Ù…Ø­Ù„ Ø²ÙˆÙ† ØªØ§ÙŠÙ…", "Ù…Ø­Ù„ Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡"],
              "Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©": ["Ù…Ø­Ù„ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø£ÙˆÙ„", "Ù…Ø­Ù„ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø«Ø§Ù†ÙŠ", "Ù…Ø­Ù„ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø«Ø§Ù„Ø«"],
              "Ø§Ù„ÙˆØ«Ø¨Ø© Ø¬Ù†ÙˆØ¨": ["Ù…Ø­Ù„ Ø§Ù„ÙˆØ«Ø¨Ø© Ø§Ù„Ø£ÙˆÙ„", "Ù…Ø­Ù„ Ø§Ù„ÙˆØ«Ø¨Ø© Ø§Ù„Ø«Ø§Ù†ÙŠ"],
              "Ù…Ø¯ÙŠÙ†Ø© Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø²Ø§ÙŠØ¯": ["Ù…Ø­Ù„ MBZ Ø§Ù„Ø£ÙˆÙ„", "Ù…Ø­Ù„ MBZ Ø§Ù„Ø«Ø§Ù†ÙŠ"],
              "Ù…Ø¯ÙŠÙ†Ø© Ø®Ù„ÙŠÙØ©": ["Ù…Ø­Ù„ Ø®Ù„ÙŠÙØ© Ø§Ù„Ø£ÙˆÙ„"]
            },
            distribution: [
              {
                inspector: "Ø¯. Ø¹Ù„ÙŠ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø§Ù„",
                day: "2025-01-15",
                shift: "Ù…Ø³Ø§Ø¦ÙŠØ©",
                area: "Ø³ÙˆÙ‚ Ø§Ù„Ø·ÙŠÙˆØ±",
                shops: ["Ù…Ø­Ù„ Ø§Ù„ÙŠØ§Ù‚ÙˆØª", "Ù…Ø­Ù„ Ø²ÙˆÙ† ØªØ§ÙŠÙ…"]
              },
              {
                inspector: "Ø¯. Ù…Ø­Ù…Ø¯ Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„",
                day: "2025-01-16",
                shift: "ØµØ¨Ø§Ø­ÙŠØ©",
                area: "Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©",
                shops: ["Ù…Ø­Ù„ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø£ÙˆÙ„", "Ù…Ø­Ù„ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø«Ø§Ù†ÙŠ"]
              },
              {
                inspector: "Ø¯. ÙØ§ÙŠØ² Ø§Ù„Ù…Ø³Ø§Ù„Ù…Ø©",
                day: "2025-01-17",
                shift: "Ù…Ø³Ø§Ø¦ÙŠØ©",
                area: "Ø§Ù„ÙˆØ«Ø¨Ø© Ø¬Ù†ÙˆØ¨",
                shops: ["Ù…Ø­Ù„ Ø§Ù„ÙˆØ«Ø¨Ø© Ø§Ù„Ø£ÙˆÙ„"]
              },
              {
                inspector: "Ø¯. Ù…Ø­Ù…Ø¯ Ø³Ø¹ÙŠØ¯",
                day: "2025-01-18",
                shift: "ØµØ¨Ø§Ø­ÙŠØ©",
                area: "Ù…Ø¯ÙŠÙ†Ø© Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø²Ø§ÙŠØ¯",
                shops: ["Ù…Ø­Ù„ MBZ Ø§Ù„Ø£ÙˆÙ„", "Ù…Ø­Ù„ MBZ Ø§Ù„Ø«Ø§Ù†ÙŠ"]
              },
              {
                inspector: "Ø¯. Ø¢ÙŠÙ‡ Ø³Ù„Ø§Ù…Ø©",
                day: "2025-01-19",
                shift: "Ù…Ø³Ø§Ø¦ÙŠØ©",
                area: "Ù…Ø¯ÙŠÙ†Ø© Ø®Ù„ÙŠÙØ©",
                shops: ["Ù…Ø­Ù„ Ø®Ù„ÙŠÙØ© Ø§Ù„Ø£ÙˆÙ„"]
              }
            ],
            goals: "Ø¶Ù…Ø§Ù† Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø§Ø´ØªØ±Ø§Ø·Ø§Øª Ø§Ù„ØµØ­ÙŠØ© ÙˆØ­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‡Ù„ÙƒÙŠÙ†"
          };
        }
        renderReport();
      } catch (error) {
        console.error('Error loading data:', error);
        renderReport();
      }
    }

    function renderReport() {
      // Set report date
      document.getElementById('reportDate').textContent = new Intl.DateTimeFormat('ar-SA', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        weekday: 'long'
      }).format(new Date());

      document.getElementById('creationDate').textContent = new Date().toLocaleDateString('ar-SA');
      
      // Basic info
      document.getElementById('goalsContent').textContent = inspectionData.goals || "Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø£Ù‡Ø¯Ø§Ù";
      document.getElementById('inspectorCount').textContent = inspectionData.inspectors.length;
      document.getElementById('areaCount').textContent = inspectionData.areas.length;
      
      let totalShops = 0;
      Object.values(inspectionData.shopsByArea).forEach(shops => totalShops += shops.length);
      document.getElementById('totalShops').textContent = totalShops;

      // Render inspectors list
      renderInspectorsList();
      
      // Render areas and shops
      renderAreasAndShops();
      
      // Render inspection table
      renderInspectionTable();
      
      // Render statistics
      renderStatistics();
      
      // Render chart
      renderChart();
    }

    function renderInspectorsList() {
      const container = document.getElementById('inspectorsList');
      let html = '<div class="data-grid">';
      
      inspectionData.inspectors.forEach((inspector, index) => {
        const inspectorTasks = inspectionData.distribution.filter(d => d.inspector === inspector);
        html += `
          <div class="data-card">
            <div class="card-title">${inspector}</div>
            <div>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ø§Ù…: ${inspectorTasks.length}</div>
          </div>
        `;
      });
      
      html += '</div>';
      container.innerHTML = html;
    }

    function renderAreasAndShops() {
      const container = document.getElementById('areasAndShops');
      let html = '<table class="professional-table"><thead><tr>';
      html += '<th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th><th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ù„Ø§Øª</th><th>Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø­Ù„Ø§Øª</th></tr></thead><tbody>';
      
      inspectionData.areas.forEach(area => {
        const shops = inspectionData.shopsByArea[area] || [];
        html += `
          <tr>
            <td><strong>${area}</strong></td>
            <td>${shops.length}</td>
            <td>${shops.join(', ') || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ù„Ø§Øª'}</td>
          </tr>
        `;
      });
      
      html += '</tbody></table>';
      container.innerHTML = html;
    }

    function renderInspectionTable() {
      const container = document.getElementById('inspectionTable');
      let html = '<table class="professional-table"><thead><tr>';
      html += '<th>Ø§Ù„Ù…ÙØªØ´</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø©</th><th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th><th>Ø§Ù„Ù…Ø­Ù„Ø§Øª</th></tr></thead><tbody>';
      
      inspectionData.distribution.forEach(item => {
        const formattedDate = new Date(item.day).toLocaleDateString('ar-SA');
        const shops = Array.isArray(item.shops) ? item.shops.join(', ') : item.shops || '';
        html += `
          <tr>
            <td><strong>${item.inspector}</strong></td>
            <td>${formattedDate}</td>
            <td>${item.shift}</td>
            <td>${item.area}</td>
            <td>${shops}</td>
          </tr>
        `;
      });
      
      html += '</tbody></table>';
      container.innerHTML = html;
    }

    function renderStatistics() {
      const container = document.getElementById('statsGrid');
      
      // Calculate statistics
      const inspectorStats = {};
      const areaStats = {};
      const shiftStats = { 'ØµØ¨Ø§Ø­ÙŠØ©': 0, 'Ù…Ø³Ø§Ø¦ÙŠØ©': 0 };
      
      inspectionData.distribution.forEach(item => {
        inspectorStats[item.inspector] = (inspectorStats[item.inspector] || 0) + 1;
        areaStats[item.area] = (areaStats[item.area] || 0) + 1;
        shiftStats[item.shift] = (shiftStats[item.shift] || 0) + 1;
      });
      
      let html = `
        <div class="stat-item">
          <div class="stat-number">${inspectionData.distribution.length}</div>
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ù‡Ø§Ù… Ø§Ù„ØªÙØªÙŠØ´</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">${shiftStats['ØµØ¨Ø§Ø­ÙŠØ©']}</div>
          <div class="stat-label">Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ©</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">${shiftStats['Ù…Ø³Ø§Ø¦ÙŠØ©']}</div>
          <div class="stat-label">Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠØ©</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">${Object.keys(inspectorStats).length}</div>
          <div class="stat-label">Ø§Ù„Ù…ÙØªØ´ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</div>
        </div>
      `;
      
      container.innerHTML = html;
    }

    function renderChart() {
      const container = document.getElementById('inspectionChart');
      const ctx = container.getContext('2d');
      
      // Create a simple chart with basic canvas drawing since Chart.js might not load
      ctx.fillStyle = '#2336a0';
      ctx.fillRect(50, 50, 100, 100);
      ctx.fillStyle = 'white';
      ctx.font = '16px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ', 100, 105);
      ctx.fillStyle = '#666';
      ctx.font = '12px Arial';
      ctx.fillText('(Ø³ÙŠØªÙ… ØªØ­Ø³ÙŠÙ†Ù‡ ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©)', 100, 125);
      
      // Try to load Chart.js dynamically for better charts
      if (typeof Chart !== 'undefined') {
        // Prepare data for chart
        const inspectorStats = {};
        inspectionData.distribution.forEach(item => {
          inspectorStats[item.inspector] = (inspectorStats[item.inspector] || 0) + 1;
        });
        
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: Object.keys(inspectorStats),
            datasets: [{
              label: 'Ø¹Ø¯Ø¯ Ù…Ù‡Ø§Ù… Ø§Ù„ØªÙØªÙŠØ´',
              data: Object.values(inspectorStats),
              backgroundColor: 'rgba(35, 54, 160, 0.8)',
              borderColor: 'rgba(35, 54, 160, 1)',
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            plugins: {
              title: {
                display: true,
                text: 'ØªÙˆØ²ÙŠØ¹ Ù…Ù‡Ø§Ù… Ø§Ù„ØªÙØªÙŠØ´ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙØªØ´ÙŠÙ†'
              }
            },
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      }
    }

    function showLoading() {
      document.getElementById('loadingMessage').style.display = 'block';
      document.getElementById('successMessage').style.display = 'none';
    }

    function showSuccess(message) {
      document.getElementById('loadingMessage').style.display = 'none';
      document.getElementById('successMessage').style.display = 'block';
      document.getElementById('successMessage').textContent = message;
      setTimeout(() => {
        document.getElementById('successMessage').style.display = 'none';
      }, 3000);
    }

    // PowerPoint Export (creates an HTML file that can be opened in PowerPoint)
    function exportToPowerPoint() {
      showLoading();
      
      try {
        const content = generatePowerPointHTML();
        const blob = new Blob([content], {type: 'text/html'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'ØªÙ‚Ø±ÙŠØ±_Ø®Ø·Ø©_Ø§Ù„ØªÙØªÙŠØ´_Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ.html';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showSuccess('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±! ÙŠÙ…ÙƒÙ†Ùƒ ÙØªØ­ Ø§Ù„Ù…Ù„Ù ÙˆØ­ÙØ¸Ù‡ ÙƒÙ€ PowerPoint Ù…Ù† Ø®Ù„Ø§Ù„ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…ÙŠØ©.');
        
      } catch (error) {
        console.error('PowerPoint export error:', error);
        showSuccess('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
      }
    }

    function generatePowerPointHTML() {
      return `
        <!DOCTYPE html>
        <html dir="rtl" lang="ar">
        <head>
          <meta charset="UTF-8">
          <title>ØªÙ‚Ø±ÙŠØ± Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</title>
          <style>
            body { font-family: Arial, sans-serif; direction: rtl; margin: 0; padding: 20px; }
            .slide { page-break-after: always; min-height: 500px; padding: 40px; margin-bottom: 50px; border: 2px solid #2336a0; }
            .slide-header { background: #2336a0; color: white; padding: 20px; margin: -40px -40px 20px -40px; text-align: center; }
            .slide-title { font-size: 2em; margin-bottom: 10px; }
            .slide-subtitle { font-size: 1.2em; opacity: 0.9; }
            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
            th, td { border: 1px solid #2336a0; padding: 10px; text-align: center; }
            th { background: #2336a0; color: white; }
            .chart-placeholder { background: #f0f0f0; height: 200px; display: flex; align-items: center; justify-content: center; margin: 20px 0; border: 2px dashed #2336a0; }
          </style>
        </head>
        <body>
          <div class="slide">
            <div class="slide-header">
              <div class="slide-title">ØªÙ‚Ø±ÙŠØ± Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</div>
              <div class="slide-subtitle">ØªÙ‚Ø±ÙŠØ± Ø§Ø­ØªØ±Ø§ÙÙŠ Ø´Ø§Ù…Ù„ Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´</div>
              <div>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${new Date().toLocaleDateString('ar-SA')}</div>
            </div>
            <div style="text-align: center; font-size: 1.5em; margin-top: 50px;">
              <p><strong>Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ØªÙØªÙŠØ´:</strong></p>
              <p style="color: #2336a0; font-size: 1.2em;">${inspectionData.goals}</p>
            </div>
          </div>

          <div class="slide">
            <div class="slide-header">
              <div class="slide-title">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø·Ø©</div>
            </div>
            <table>
              <tr><th>Ø§Ù„Ù…Ø¤Ø´Ø±</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr>
              <tr><td>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙØªØ´ÙŠÙ†</td><td>${inspectionData.inspectors.length}</td></tr>
              <tr><td>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</td><td>${inspectionData.areas.length}</td></tr>
              <tr><td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ù„Ø§Øª</td><td>${Object.values(inspectionData.shopsByArea).reduce((sum, shops) => sum + shops.length, 0)}</td></tr>
              <tr><td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ù‡Ø§Ù… Ø§Ù„ØªÙØªÙŠØ´</td><td>${inspectionData.distribution.length}</td></tr>
            </table>
          </div>

          <div class="slide">
            <div class="slide-header">
              <div class="slide-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØªØ´ÙŠÙ†</div>
            </div>
            <table>
              <tr><th>Ø§Ù„Ù…ÙØªØ´</th><th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ø§Ù…</th></tr>
              ${inspectionData.inspectors.map(inspector => {
                const taskCount = inspectionData.distribution.filter(d => d.inspector === inspector).length;
                return `<tr><td>${inspector}</td><td>${taskCount}</td></tr>`;
              }).join('')}
            </table>
          </div>

          <div class="slide">
            <div class="slide-header">
              <div class="slide-title">Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</div>
            </div>
            <table>
              <tr><th>Ø§Ù„Ù…ÙØªØ´</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø©</th><th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th></tr>
              ${inspectionData.distribution.map(item => `
                <tr>
                  <td>${item.inspector}</td>
                  <td>${new Date(item.day).toLocaleDateString('ar-SA')}</td>
                  <td>${item.shift}</td>
                  <td>${item.area}</td>
                </tr>
              `).join('')}
            </table>
          </div>

          <div class="slide">
            <div class="slide-header">
              <div class="slide-title">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ù…Ø¤Ø´Ø±Ø§Øª</div>
            </div>
            <div class="chart-placeholder">
              <div style="text-align: center;">
                <h3>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙØªÙŠØ´</h3>
                <p>Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ©: ${inspectionData.distribution.filter(d => d.shift === 'ØµØ¨Ø§Ø­ÙŠØ©').length}</p>
                <p>Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠØ©: ${inspectionData.distribution.filter(d => d.shift === 'Ù…Ø³Ø§Ø¦ÙŠØ©').length}</p>
              </div>
            </div>
          </div>
        </body>
        </html>
      `;
    }

    // Excel Export (CSV format that can be opened in Excel)
    function exportToExcel() {
      showLoading();
      
      try {
        let csvContent = '\uFEFF'; // BOM for UTF-8
        csvContent += 'ØªÙ‚Ø±ÙŠØ± Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©\n';
        csvContent += `ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±,${new Date().toLocaleDateString('ar-SA')}\n\n`;
        
        csvContent += 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ù…Ø©\n';
        csvContent += `Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙØªØ´ÙŠÙ†,${inspectionData.inspectors.length}\n`;
        csvContent += `Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚,${inspectionData.areas.length}\n`;
        csvContent += `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ù„Ø§Øª,${Object.values(inspectionData.shopsByArea).reduce((sum, shops) => sum + shops.length, 0)}\n`;
        csvContent += `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ù‡Ø§Ù… Ø§Ù„ØªÙØªÙŠØ´,${inspectionData.distribution.length}\n\n`;
        
        csvContent += 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØªØ´ÙŠÙ† ÙˆÙ…Ù‡Ø§Ù…Ù‡Ù…\n';
        csvContent += 'Ø§Ù„Ù…ÙØªØ´,Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ø§Ù…\n';
        inspectionData.inspectors.forEach(inspector => {
          const taskCount = inspectionData.distribution.filter(d => d.inspector === inspector).length;
          csvContent += `"${inspector}",${taskCount}\n`;
        });
        
        csvContent += '\nØ¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ\n';
        csvContent += 'Ø§Ù„Ù…ÙØªØ´,Ø§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø©,Ø§Ù„Ù…Ù†Ø·Ù‚Ø©,Ø§Ù„Ù…Ø­Ù„Ø§Øª\n';
        inspectionData.distribution.forEach(item => {
          const shops = Array.isArray(item.shops) ? item.shops.join('; ') : item.shops || '';
          csvContent += `"${item.inspector}","${new Date(item.day).toLocaleDateString('ar-SA')}","${item.shift}","${item.area}","${shops}"\n`;
        });

        const blob = new Blob([csvContent], {type: 'text/csv;charset=utf-8;'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'ØªÙ‚Ø±ÙŠØ±_Ø®Ø·Ø©_Ø§Ù„ØªÙØªÙŠØ´_Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ.csv';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showSuccess('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ Excel Ø¨Ù†Ø¬Ø§Ø­! (Ù…Ù„Ù CSV)');
        
      } catch (error) {
        console.error('Excel export error:', error);
        showSuccess('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
      }
    }

    // Word Export (HTML format compatible with Word)
    function exportToWord() {
      showLoading();
      
      try {
        let htmlContent = `
          <!DOCTYPE html>
          <html dir="rtl">
          <head>
            <meta charset="UTF-8">
            <title>ØªÙ‚Ø±ÙŠØ± Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</title>
            <style>
              body { font-family: Arial, sans-serif; direction: rtl; }
              .header { background: #2336a0; color: white; padding: 20px; text-align: center; }
              .section { margin: 20px 0; }
              .section-title { background: #e2e6f6; padding: 10px; font-weight: bold; color: #2336a0; }
              table { width: 100%; border-collapse: collapse; margin: 10px 0; }
              th, td { border: 1px solid #ccc; padding: 8px; text-align: right; }
              th { background: #2336a0; color: white; }
            </style>
          </head>
          <body>
            <div class="header">
              <h1>ØªÙ‚Ø±ÙŠØ± Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h1>
              <p>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${new Date().toLocaleDateString('ar-SA')}</p>
            </div>
            
            <div class="section">
              <div class="section-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ù…Ø©</div>
              <p><strong>Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ØªÙØªÙŠØ´:</strong> ${inspectionData.goals}</p>
              <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙØªØ´ÙŠÙ†:</strong> ${inspectionData.inspectors.length}</p>
              <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚:</strong> ${inspectionData.areas.length}</p>
            </div>
            
            <div class="section">
              <div class="section-title">Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØªÙŠØ´</div>
              <table>
                <thead>
                  <tr><th>Ø§Ù„Ù…ÙØªØ´</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø©</th><th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th></tr>
                </thead>
                <tbody>
        `;
        
        inspectionData.distribution.forEach(item => {
          htmlContent += `
            <tr>
              <td>${item.inspector}</td>
              <td>${new Date(item.day).toLocaleDateString('ar-SA')}</td>
              <td>${item.shift}</td>
              <td>${item.area}</td>
            </tr>
          `;
        });
        
        htmlContent += `
                </tbody>
              </table>
            </div>
          </body>
          </html>
        `;

        const blob = new Blob([htmlContent], {type: 'application/msword'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'ØªÙ‚Ø±ÙŠØ±_Ø®Ø·Ø©_Ø§Ù„ØªÙØªÙŠØ´_Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ.doc';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showSuccess('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ Word Ø¨Ù†Ø¬Ø§Ø­!');
        
      } catch (error) {
        console.error('Word export error:', error);
        showSuccess('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
      }
    }

    // PDF Export (simplified version)
    function exportToPDF() {
      showLoading();
      
      try {
        // Create a clean version for PDF
        const printContent = document.querySelector('.report-container').cloneNode(true);
        const exportButtons = printContent.querySelector('.export-buttons');
        if (exportButtons) exportButtons.remove();
        
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
          <!DOCTYPE html>
          <html dir="rtl">
          <head>
            <meta charset="UTF-8">
            <title>ØªÙ‚Ø±ÙŠØ± Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</title>
            <style>
              body { font-family: Arial, sans-serif; direction: rtl; margin: 20px; }
              .report-container { max-width: 100%; }
              .header-section { background: #2336a0; color: white; padding: 20px; text-align: center; margin-bottom: 20px; }
              .section-header { background: #e2e6f6; color: #2336a0; font-weight: bold; padding: 10px; margin: 20px 0 10px 0; }
              table { width: 100%; border-collapse: collapse; margin: 10px 0; }
              th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
              th { background: #2336a0; color: white; }
              .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
              .data-card { background: #f8f9ff; padding: 15px; border: 1px solid #e2e6f6; margin: 10px 0; }
              .card-title { font-weight: bold; color: #2336a0; margin-bottom: 10px; }
              @media print { body { margin: 0; } }
            </style>
          </head>
          <body>
            ${printContent.outerHTML}
          </body>
          </html>
        `);
        printWindow.document.close();
        
        setTimeout(() => {
          printWindow.print();
          showSuccess('ØªÙ… ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©! ÙŠÙ…ÙƒÙ†Ùƒ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙƒÙ€ PDF Ù…Ù† Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©.');
        }, 1000);
        
      } catch (error) {
        console.error('PDF export error:', error);
        showSuccess('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
      }
    }

    // Initialize
    loadInspectionData();
  </script>
</body>
</html>